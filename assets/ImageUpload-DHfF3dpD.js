import{j as e}from"./ui-3dZ77hvN.js";import{r as x}from"./vendor-D6c-Jqks.js";import{c as P,d as f,I as U,B as h,s as v}from"./index-CGuH8YYo.js";import{X as L,L as A,aq as C,ar as S}from"./icons-CUeChpmy.js";import"./supabase-kH73mCB1.js";const G=({value:t,onChange:n,label:j="Imagem",placeholder:N="URL da imagem ou faça upload",bucket:m="blog-images"})=>{const[o,d]=x.useState(!1),[b,c]=x.useState(!1),{toast:i}=P(),u=async a=>{if(a){if(!a.type.startsWith("image/")){i({variant:"destructive",title:"Erro",description:"Por favor, selecione apenas arquivos de imagem."});return}if(a.size>5*1024*1024){i({variant:"destructive",title:"Erro",description:"A imagem deve ter no máximo 5MB."});return}d(!0);try{const r=a.name.split(".").pop(),p=`${`${Math.random().toString(36).substr(2,9)}.${r}`}`,{error:g}=await v.storage.from(m).upload(p,a);if(g)throw g;const{data:l}=v.storage.from(m).getPublicUrl(p);l!=null&&l.publicUrl&&(n(l.publicUrl),i({title:"Sucesso",description:"Imagem carregada com sucesso!"}))}catch(r){console.error("Error uploading image:",r),i({variant:"destructive",title:"Erro",description:r.message||"Erro ao carregar imagem"})}finally{d(!1)}}},y=a=>{var s;const r=(s=a.target.files)==null?void 0:s[0];r&&u(r)},D=a=>{var s;a.preventDefault(),c(!1);const r=(s=a.dataTransfer.files)==null?void 0:s[0];r&&u(r)},E=a=>{a.preventDefault(),c(!0)},w=a=>{a.preventDefault(),c(!1)},I=()=>{n("")};return e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:j}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(U,{value:t,onChange:a=>n(a.target.value),placeholder:N,className:"flex-1"}),t&&e.jsx(h,{type:"button",variant:"outline",size:"icon",onClick:I,className:"flex-shrink-0",children:e.jsx(L,{className:"h-4 w-4"})})]}),e.jsx("div",{className:`border-2 border-dashed rounded-lg p-6 text-center transition-colors ${b?"border-primary bg-primary/5":"border-muted-foreground/25 hover:border-muted-foreground/50"}`,onDrop:D,onDragOver:E,onDragLeave:w,children:o?e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(A,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Carregando imagem..."})]}):e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(C,{className:"h-8 w-8 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Arraste uma imagem ou clique para selecionar"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"PNG, JPG, GIF até 5MB"})]}),e.jsx("input",{type:"file",accept:"image/*",onChange:y,className:"hidden",id:"image-upload",disabled:o}),e.jsx("label",{htmlFor:"image-upload",children:e.jsx(h,{type:"button",variant:"outline",size:"sm",disabled:o,asChild:!0,children:e.jsxs("span",{className:"cursor-pointer",children:[e.jsx(S,{className:"h-4 w-4 mr-2"}),"Selecionar Arquivo"]})})})]})}),t&&!o&&e.jsxs("div",{className:"mt-4",children:[e.jsx(f,{className:"text-sm text-muted-foreground",children:"Preview:"}),e.jsx("div",{className:"mt-2 relative inline-block",children:e.jsx("img",{src:t,alt:"Preview",className:"max-w-full max-h-48 rounded-lg border",onError:a=>{a.currentTarget.style.display="none"}})})]})]})};export{G as ImageUpload};
