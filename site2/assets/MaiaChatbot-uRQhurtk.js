import{j as t}from"./ui-3dZ77hvN.js";import{r as a}from"./vendor-D6c-Jqks.js";import{M as H,i as W,u as L,P as F,a as O,b as T,L as V,c as q,m as z,B as I,I as A,s as G}from"./index-CGuH8YYo.js";import{X as K,a1 as _,ap as B,a5 as X}from"./icons-CUeChpmy.js";import"./supabase-kH73mCB1.js";class J extends a.Component{getSnapshotBeforeUpdate(x){const r=this.props.childRef.current;if(r&&x.isPresent&&!this.props.isPresent){const f=r.offsetParent,g=W(f)&&f.offsetWidth||0,o=this.props.sizeRef.current;o.height=r.offsetHeight||0,o.width=r.offsetWidth||0,o.top=r.offsetTop,o.left=r.offsetLeft,o.right=g-o.width-o.left}return null}componentDidUpdate(){}render(){return this.props.children}}function Q({children:d,isPresent:x,anchorX:r,root:f}){const g=a.useId(),o=a.useRef(null),b=a.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:N}=a.useContext(H);return a.useInsertionEffect(()=>{const{width:M,height:m,top:p,left:u,right:y}=b.current;if(x||!o.current||!M||!m)return;const v=r==="left"?`left: ${u}`:`right: ${y}`;o.current.dataset.motionPopId=g;const h=document.createElement("style");N&&(h.nonce=N);const j=f??document.head;return j.appendChild(h),h.sheet&&h.sheet.insertRule(`
          [data-motion-pop-id="${g}"] {
            position: absolute !important;
            width: ${M}px !important;
            height: ${m}px !important;
            ${v}px !important;
            top: ${p}px !important;
          }
        `),()=>{j.contains(h)&&j.removeChild(h)}},[x]),t.jsx(J,{isPresent:x,childRef:o,sizeRef:b,children:a.cloneElement(d,{ref:o})})}const Y=({children:d,initial:x,isPresent:r,onExitComplete:f,custom:g,presenceAffectsLayout:o,mode:b,anchorX:N,root:M})=>{const m=L(Z),p=a.useId();let u=!0,y=a.useMemo(()=>(u=!1,{id:p,initial:x,isPresent:r,custom:g,onExitComplete:v=>{m.set(v,!0);for(const h of m.values())if(!h)return;f&&f()},register:v=>(m.set(v,!1),()=>m.delete(v))}),[r,m,f]);return o&&u&&(y={...y}),a.useMemo(()=>{m.forEach((v,h)=>m.set(h,!1))},[r]),a.useEffect(()=>{!r&&!m.size&&f&&f()},[r]),b==="popLayout"&&(d=t.jsx(Q,{isPresent:r,anchorX:N,root:M,children:d})),t.jsx(F.Provider,{value:y,children:d})};function Z(){return new Map}const P=d=>d.key||"";function D(d){const x=[];return a.Children.forEach(d,r=>{a.isValidElement(r)&&x.push(r)}),x}const ee=({children:d,custom:x,initial:r=!0,onExitComplete:f,presenceAffectsLayout:g=!0,mode:o="sync",propagate:b=!1,anchorX:N="left",root:M})=>{const[m,p]=O(b),u=a.useMemo(()=>D(d),[d]),y=b&&!m?[]:u.map(P),v=a.useRef(!0),h=a.useRef(u),j=L(()=>new Map),[U,k]=a.useState(u),[C,E]=a.useState(u);T(()=>{v.current=!1,h.current=u;for(let w=0;w<C.length;w++){const e=P(C[w]);y.includes(e)?j.delete(e):j.get(e)!==!0&&j.set(e,!1)}},[C,y.length,y.join("-")]);const $=[];if(u!==U){let w=[...u];for(let e=0;e<C.length;e++){const s=C[e],l=P(s);y.includes(l)||(w.splice(e,0,s),$.push(s))}return o==="wait"&&$.length&&(w=$),E(D(w)),k(u),null}const{forceRender:S}=a.useContext(V);return t.jsx(t.Fragment,{children:C.map(w=>{const e=P(w),s=b&&!m?!1:u===C||y.includes(e),l=()=>{if(j.has(e))j.set(e,!0);else return;let i=!0;j.forEach(c=>{c||(i=!1)}),i&&(S==null||S(),E(h.current),b&&(p==null||p()),f&&f())};return t.jsx(Y,{isPresent:s,initial:!v.current||r?void 0:!1,custom:x,presenceAffectsLayout:g,mode:o,root:M,onExitComplete:s?void 0:l,anchorX:N,children:w},e)})})},ie=()=>{const[d,x]=a.useState(!1),[r,f]=a.useState([{id:"1",text:`OlÃ¡! Eu sou a Maia ðŸŒ¿, assistente virtual do HUB Amazoom.

Estou aqui para te ajudar com informaÃ§Ãµes sobre nossos serviÃ§os e te conectar com nossa equipe quando necessÃ¡rio.

Como posso te ajudar hoje? ðŸ˜Š`,isBot:!0,timestamp:new Date}]),[g,o]=a.useState(""),[b,N]=a.useState(!1),[M,m]=a.useState(!1),[p,u]=a.useState({name:"",email:"",phone:""}),[y,v]=a.useState("initial"),h=a.useRef(null),{toast:j}=q(),U=()=>{var e;(e=h.current)==null||e.scrollIntoView({behavior:"smooth"})};a.useEffect(()=>{U()},[r]);const k=(e,s,l,i)=>{const c={id:Date.now().toString(),text:e,isBot:s,timestamp:new Date,type:l,whatsappUrl:i};f(n=>[...n,c])},C=()=>{let e="",s="",l="";const i=r.filter(c=>!c.isBot);for(let c=0;c<i.length;c++){const n=i[c].text.toLowerCase().trim();if(n.includes("endereÃ§o")||n.includes("fiscal")?e="EndereÃ§o Fiscal":n.includes("coworking")||n.includes("espaÃ§o")?e="EspaÃ§o de Coworking":n.includes("reuniÃ£o")||n.includes("salas")?e="Salas de ReuniÃ£o":(n.includes("outros")||n.includes("serviÃ§os"))&&(e="Outros ServiÃ§os"),!s&&n.length>2&&!n.includes("@")&&!n.includes("quero")&&!n.includes("preciso")&&!n.includes("gostaria")&&!n.match(/^\d+$/)){const R=i[c].text.trim().split(" ");R.length>=1&&R[0].length>2&&(s=i[c].text.trim())}!l&&n.includes("@")&&n.includes(".")&&(l=i[c].text.trim())}return{subject:e,name:s,email:l}},E=async()=>{if(!g.trim())return;const e=g.trim();k(e,!1),o(""),N(!0);try{const{data:s,error:l}=await G.functions.invoke("maia-chatbot",{body:{message:e,conversationHistory:r}});if(l)throw console.error("Supabase error:",l),l;const i=s==null?void 0:s.response;if(i!=null&&i.text)if(i.text.includes("WhatsApp")||i.text.includes("whatsapp")||i.text.includes("equipe")||i.text.includes("atendimento")){const c=C();let n="OlÃ¡! Vim atravÃ©s da Maia, assistente virtual do HUB Amazoom.";c.name&&(n+=` Meu nome Ã© ${c.name}.`),c.email&&(n+=` Meu e-mail Ã© ${c.email}.`),c.subject?n+=` Gostaria de saber mais sobre ${c.subject}.`:n+=" Gostaria de conhecer os serviÃ§os da HUB Amazoom.";const R=`https://wa.me/559684156605?text=${encodeURIComponent(n)}`;k(i.text,!0,"whatsapp-redirect",R)}else k(i.text,!0,i.type)}catch(s){console.error("Error calling chatbot:",s),k("Desculpe, houve um erro. Tente novamente.",!0)}finally{N(!1)}},$=()=>{if(!p.name||!p.email||!p.phone){j({title:"Campos obrigatÃ³rios",description:"Por favor, preencha todos os campos.",variant:"destructive"});return}m(!1),v("info-collected"),k(`Perfeito, ${p.name}! Suas informaÃ§Ãµes foram registradas. Agora posso ajudÃ¡-lo de forma mais personalizada. Como posso ajudÃ¡-lo hoje?`,!0),console.log("User info collected:",p)},S=e=>{if(e){window.open(e,"_blank");return}const s=C();let l="OlÃ¡! Vim atravÃ©s da Maia, assistente virtual do HUB Amazoom.";s.name&&(l+=` Meu nome Ã© ${s.name}.`),s.email&&(l+=` Meu e-mail Ã© ${s.email}.`),s.subject?l+=` Gostaria de saber mais sobre ${s.subject}.`:l+=" Gostaria de conhecer os serviÃ§os da HUB Amazoom.",window.open(`https://wa.me/559684156605?text=${encodeURIComponent(l)}`,"_blank")},w=e=>{e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),E())};return t.jsxs(t.Fragment,{children:[t.jsx(z.div,{className:"fixed bottom-6 right-6 z-50",initial:{scale:0},animate:{scale:1},transition:{delay:2,type:"spring",stiffness:260,damping:20},children:t.jsx(I,{onClick:()=>x(!d),className:`w-16 h-16 rounded-full shadow-lg ${d?"bg-red-500 hover:bg-red-600":"bg-primary hover:bg-primary/90"} text-black transition-all duration-300`,children:d?t.jsx(K,{className:"w-6 h-6"}):t.jsx(_,{className:"w-6 h-6"})})}),t.jsx(ee,{children:d&&t.jsx(z.div,{initial:{opacity:0,y:100,scale:.3},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:100,scale:.3},transition:{type:"spring",stiffness:260,damping:20},className:"fixed bottom-24 right-6 w-96 h-[600px] max-w-[calc(100vw-3rem)] max-h-[calc(100vh-8rem)] z-50",children:t.jsxs("div",{className:"cyber-card h-full flex flex-col bg-black/90 backdrop-blur-sm",children:[t.jsxs("div",{className:"flex items-center gap-3 p-4 border-b border-primary/20",children:[t.jsx("div",{className:"w-10 h-10 rounded-full overflow-hidden bg-primary/20 flex items-center justify-center",children:t.jsx("img",{src:"/lovable-uploads/a7f0db7a-bfaa-4566-9fbd-b491a83faf7d.png",alt:"Maia Avatar",className:"w-10 h-10 object-cover rounded-full"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"font-semibold text-primary",children:"Maia"}),t.jsx("p",{className:"text-xs text-white/60",children:"Assistente Virtual"})]}),t.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full animate-pulse"})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[r.map(e=>t.jsx("div",{className:`flex ${e.isBot?"justify-start":"justify-end"}`,children:t.jsxs("div",{className:`max-w-[80%] p-3 rounded-lg ${e.isBot?"bg-primary/20 text-white border border-primary/30":"bg-secondary text-black"}`,children:[t.jsx("p",{className:"text-sm whitespace-pre-line",children:e.text}),e.type==="human-contact"&&t.jsxs(I,{onClick:()=>S(),className:"mt-2 bg-green-500 hover:bg-green-600 text-white text-xs px-3 py-1",children:[t.jsx(B,{className:"w-3 h-3 mr-1"}),"Abrir WhatsApp"]}),e.type==="whatsapp-redirect"&&e.whatsappUrl&&t.jsxs(I,{onClick:()=>S(e.whatsappUrl),className:"mt-3 bg-green-500 hover:bg-green-600 text-white w-full",children:[t.jsx(B,{className:"w-4 h-4 mr-2"}),"Abrir WhatsApp"]})]})},e.id)),M&&t.jsxs(z.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"bg-card p-4 rounded-lg border border-primary/30",children:[t.jsx("h4",{className:"text-primary font-semibold mb-3",children:"Vamos nos conhecer melhor!"}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{children:t.jsx(A,{placeholder:"Seu nome",value:p.name,onChange:e=>u(s=>({...s,name:e.target.value})),className:"bg-background/50 border-primary/30"})}),t.jsx("div",{children:t.jsx(A,{type:"email",placeholder:"Seu e-mail",value:p.email,onChange:e=>u(s=>({...s,email:e.target.value})),className:"bg-background/50 border-primary/30"})}),t.jsx("div",{children:t.jsx(A,{placeholder:"Seu telefone",value:p.phone,onChange:e=>u(s=>({...s,phone:e.target.value})),className:"bg-background/50 border-primary/30"})}),t.jsx(I,{onClick:$,className:"w-full bg-primary hover:bg-primary/90 text-black",children:"Continuar"})]})]}),b&&t.jsx("div",{className:"flex justify-start",children:t.jsx("div",{className:"bg-primary/20 text-white border border-primary/30 p-3 rounded-lg",children:t.jsxs("div",{className:"flex space-x-1",children:[t.jsx("div",{className:"w-2 h-2 bg-primary rounded-full animate-bounce"}),t.jsx("div",{className:"w-2 h-2 bg-primary rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),t.jsx("div",{className:"w-2 h-2 bg-primary rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})})}),t.jsx("div",{ref:h})]}),t.jsx("div",{className:"p-4 border-t border-primary/20",children:t.jsxs("div",{className:"flex gap-2",children:[t.jsx(A,{value:g,onChange:e=>o(e.target.value),onKeyPress:w,placeholder:"Digite sua mensagem...",className:"flex-1 bg-background/50 border-primary/30",disabled:b}),t.jsx(I,{onClick:E,disabled:b||!g.trim(),className:"bg-primary hover:bg-primary/90 text-black",children:t.jsx(X,{className:"w-4 h-4"})})]})})]})})})]})};export{ie as MaiaChatbot,ie as default};
